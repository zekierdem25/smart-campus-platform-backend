{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\zekierdem\\\\Desktop\\\\web_final\\\\frontend\\\\src\\\\context\\\\AuthContext.jsx\",\n  _s = $RefreshSig$();\nimport { createContext, useState, useEffect } from \"react\";\nimport api from \"../api/axios\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthContext = /*#__PURE__*/createContext();\nexport function AuthProvider({\n  children\n}) {\n  _s();\n  const [accessToken, setAccessToken] = useState(localStorage.getItem(\"accessToken\") || null);\n  const [user, setUser] = useState(null);\n\n  // Token değiştiğinde kullanıcı bilgilerini çek\n  useEffect(() => {\n    if (accessToken) {\n      fetchMe();\n    }\n  }, [accessToken]);\n\n  // --- KULLANICI BILGISI ÇEKME ---\n  async function fetchMe() {\n    try {\n      console.log(\"→ GET /users/me\");\n      const res = await api.get(\"/users/me\", {\n        headers: {\n          Authorization: `Bearer ${accessToken}`\n        }\n      });\n      console.log(\"✓ Me response:\", res.data);\n      setUser(res.data.user);\n    } catch (err) {\n      console.error(\"✗ Me fetch error:\", err);\n      logout();\n    }\n  }\n\n  // --- LOGIN ---\n  async function login(email, password) {\n    try {\n      const res = await api.post(\"/auth/login\", {\n        email,\n        password\n      });\n      if (!res.data.success || !res.data.accessToken) {\n        return {\n          ok: false,\n          message: res.data.message || \"Login failed\"\n        };\n      }\n      const token = res.data.accessToken;\n\n      // 1) Önce localStorage'a yaz\n      localStorage.setItem(\"accessToken\", token);\n\n      // 2) Sonra state'i güncelle\n      setAccessToken(token);\n\n      // 3) FetchMe çağrısını state güncellendikten SONRA çalıştır\n      setTimeout(() => {\n        fetchMe();\n      }, 0);\n      return {\n        ok: true\n      };\n    } catch (err) {\n      var _err$response, _err$response$data;\n      return {\n        ok: false,\n        message: ((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.message) || \"Login error\"\n      };\n    }\n  }\n  function logout() {\n    console.log(\"→ logout()\");\n    localStorage.removeItem(\"accessToken\");\n    setAccessToken(null);\n    setUser(null);\n  }\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      user,\n      accessToken,\n      login,\n      logout\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 76,\n    columnNumber: 5\n  }, this);\n}\n_s(AuthProvider, \"Df28R4vydTt4kFo4iyjz4YdnpDY=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["createContext","useState","useEffect","api","jsxDEV","_jsxDEV","AuthContext","AuthProvider","children","_s","accessToken","setAccessToken","localStorage","getItem","user","setUser","fetchMe","console","log","res","get","headers","Authorization","data","err","error","logout","login","email","password","post","success","ok","message","token","setItem","setTimeout","_err$response","_err$response$data","response","removeItem","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/zekierdem/Desktop/web_final/frontend/src/context/AuthContext.jsx"],"sourcesContent":["import { createContext, useState, useEffect } from \"react\";\r\nimport api from \"../api/axios\";\r\n\r\nexport const AuthContext = createContext();\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [accessToken, setAccessToken] = useState(\r\n    localStorage.getItem(\"accessToken\") || null\r\n  );\r\n\r\n  const [user, setUser] = useState(null);\r\n\r\n  // Token değiştiğinde kullanıcı bilgilerini çek\r\n  useEffect(() => {\r\n    if (accessToken) {\r\n      fetchMe();\r\n    }\r\n  }, [accessToken]);\r\n\r\n  // --- KULLANICI BILGISI ÇEKME ---\r\n  async function fetchMe() {\r\n    try {\r\n      console.log(\"→ GET /users/me\");\r\n      const res = await api.get(\"/users/me\", {\r\n        headers: { Authorization: `Bearer ${accessToken}` },\r\n      });\r\n\r\n      console.log(\"✓ Me response:\", res.data);\r\n      setUser(res.data.user);\r\n    } catch (err) {\r\n      console.error(\"✗ Me fetch error:\", err);\r\n      logout();\r\n    }\r\n  }\r\n\r\n  // --- LOGIN ---\r\n  async function login(email, password) {\r\n  try {\r\n    const res = await api.post(\"/auth/login\", { email, password });\r\n\r\n    if (!res.data.success || !res.data.accessToken) {\r\n      return { ok: false, message: res.data.message || \"Login failed\" };\r\n    }\r\n\r\n    const token = res.data.accessToken;\r\n\r\n    // 1) Önce localStorage'a yaz\r\n    localStorage.setItem(\"accessToken\", token);\r\n\r\n    // 2) Sonra state'i güncelle\r\n    setAccessToken(token);\r\n\r\n    // 3) FetchMe çağrısını state güncellendikten SONRA çalıştır\r\n    setTimeout(() => {\r\n      fetchMe();\r\n    }, 0);\r\n\r\n    return { ok: true };\r\n  } catch (err) {\r\n    return {\r\n      ok: false,\r\n      message: err.response?.data?.message || \"Login error\",\r\n    };\r\n  }\r\n}\r\n\r\n\r\n  function logout() {\r\n    console.log(\"→ logout()\");\r\n    localStorage.removeItem(\"accessToken\");\r\n    setAccessToken(null);\r\n    setUser(null);\r\n  }\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        user,\r\n        accessToken,\r\n        login,\r\n        logout,\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}